<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Custom A/B Image Slider (Pixel-Based)</title>
  <style>
    /* 
      1) .ab-slider wraps the “Before” image in normal flow, so its width & height 
         come directly from the image itself (intrinsic or responsive). 
      2) We position the “After” wrapper absolutely on top and clip it in px. 
    */
    .ab-slider {
      position: relative;
      display: inline-block;    /* shrink-wrap to the Before image’s width */
      user-select: none;        /* prevent text selection while dragging */
      overflow: hidden;
    }

    /* 
      “Before” image defines the slider’s natural size. 
      width: 100% makes it responsive if you wrap .ab-slider in a smaller parent. 
    */
    .ab-slider > img.before-img {
      display: block;
      width: 100%;   /* fill the container (or intrinsic size if container is auto) */
      height: auto;  /* preserve aspect ratio */
    }

    /* 
      The “After” wrapper:
      • absolutely positioned on top of the Before image 
      • initial width = 50% of the slider’s current width (set by JS) 
      • height = 100% of slider’s height 
      • overflow:hidden → only the left portion of the After image is visible  
    */
    .ab-slider .after {
      position: absolute;
      top: 0;
      left: 0;
      width: 0px;        /* JS will set this to half of slider width on page load */
      height: 100%;      /* match the entire slider height */
      overflow: hidden;  /* clip any part of the child After image outside this px width */
      z-index: 1;        /* atop the Before image */
      pointer-events: none; /* let the handle capture drags */
    }

    /* 
      The “After” image:
      • absolutely on top of the Before image (so it lines up exactly). 
      • width: 100% makes it exactly match slider’s width in px. 
    */
    .ab-slider .after img.after-img {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;      /* always fill the slider’s full width in px */
      height: auto;     /* preserve aspect ratio */
      z-index: 1;
    }

    /* 
      The draggable handle (vertical bar):
      • positioned at X px (JS sets left: X px). 
      • height: 100% to span the entire slider height. 
    */
    .ab-slider .handle {
      position: absolute;
      top: 0;
      left: 50px;        /* initial X px (updated by JS to half of slider width) */
      width: 4px;        /* thickness of the vertical divider */
      height: 100%;
      background: rgba(255, 255, 255, 0.9);
      cursor: ew-resize;
      z-index: 2;        /* above both images */
      transform: translateX(-2px); /* center the 4px bar at its left coordinate */
    }

    /* 
      A small circular “dot” on the handle for better UX 
    */
    .ab-slider .handle::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 12px;
      height: 12px;
      background: rgba(0, 0, 0, 0.5);
      border-radius: 50%;
      transform: translate(-50%, -50%);
    }
  </style>
</head>
<body>
  <!-- 
    1) BEFORE image appears in normal flow. 
    2) AFTER wrapper (set to clip via px). 
    3) Handle sits on top. 
  -->
  <div class="ab-slider" id="mySlider">
    <!-- “Before” image (in normal flow) -->
    <img
      class="before-img"
      src="images/before.png"
      alt="Before image"
    />

    <!-- “After” wrapper that clips its child in px -->
    <div class="after" id="afterWrapper">
      <!-- “After” image must be exactly the same image size as Before -->
      <img
        class="after-img"
        src="images/after.png"
        alt="After image"
      />
    </div>

    <!-- Draggable vertical handle -->
    <div class="handle" id="sliderHandle"></div>
  </div>

  <script>
    (function() {
      const slider = document.getElementById('mySlider');
      const handle = document.getElementById('sliderHandle');
      const afterWrapper = document.getElementById('afterWrapper');
      let isDragging = false;

      // Helper: Set initial wrapper width to half of slider’s width (in px)
      function initSlider() {
        // Wait until slider’s images have fully loaded to get correct dimensions
        const beforeImg = slider.querySelector('img.before-img');
        if (!beforeImg.complete) {
          // If the “Before” image isn’t fully loaded, retry in 50ms
          setTimeout(initSlider, 50);
          return;
        }
        // Now the slider DIV has the correct width
        const sliderRect = slider.getBoundingClientRect();
        const initialHalf = sliderRect.width / 2; // half in px
        // Set both the clipping wrapper and the handle to that half-width
        afterWrapper.style.width = initialHalf + 'px';
        handle.style.left = initialHalf + 'px';
      }

      function onDrag(e) {
        if (!isDragging) return;
        // 1) Get slider’s bounding rectangle
        const rect = slider.getBoundingClientRect();
        // 2) Compute X relative to slider’s left edge (in px)
        let x = (e.touches ? e.touches[0].clientX : e.clientX) - rect.left;
        // 3) Clamp x between [0 .. rect.width]
        if (x < 0) x = 0;
        if (x > rect.width) x = rect.width;
        // 4) Set the wrapper’s width in px (clip the After image) and move the handle
        afterWrapper.style.width = x + 'px';
        handle.style.left = x + 'px';
      }

      // When user presses the handle, start dragging
      handle.addEventListener('mousedown', () => { isDragging = true; });
      handle.addEventListener('touchstart', () => { isDragging = true; });

      // As the pointer moves, update the wrapper’s px width
      document.addEventListener('mousemove', onDrag);
      document.addEventListener('touchmove', onDrag);

      // When user releases, stop dragging
      document.addEventListener('mouseup', () => { isDragging = false; });
      document.addEventListener('touchend', () => { isDragging = false; });

      // Initialize once the page loads
      window.addEventListener('load', initSlider);
      // If images were already loaded, call it immediately
      if (document.readyState === 'complete') initSlider();
    })();
  </script>
</body>
</html>
