<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Square‐Friendly A/B Slider</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      overflow: hidden; /* no scrollbars */
      height: 100vh;    /* ensure the body fills the iframe */
    }

    /* 
      Make the slider fill 100% of both width and height of its parent.
      That way, if the iframe is 800×800, .slider is exactly 800×800.
    */
    .slider {
      position: relative;
      width: 100%;
      height: 100%;
      overflow: hidden;
      user-select: none;
    }

    /* 
      Force both images to fill 100% width & height of .slider.
      Use object‐fit to preserve aspect‐ratio but allow letterboxing.
    */
    .slider > img.before-img {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: contain;  /* or “cover” if you want them cropped */
      z-index: 0;
    }

    .slider img.after-img {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: contain;
      z-index: 1;
      /* start by hiding the right 50%, in percentage */
      clip-path: inset(0 50% 0 0);
    }

    /* The handle still spans full container height */
    .slider .handle {
      position: absolute;
      top: 0;
      left: 50%;
      width: 4px;
      height: 100%;
      background: rgba(255,255,255,0.9);
      cursor: ew-resize;
      z-index: 2;
      transform: translateX(-2px);
    }
    .slider .handle::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 12px;
      height: 12px;
      background: rgba(0,0,0,0.5);
      border-radius: 50%;
      transform: translate(-50%, -50%);
    }
  </style>
</head>
<body>
  <div class="slider" id="slider">
    <img id="beforeImg" class="before-img" src="" alt="Before" />
    <img id="afterImg"  class="after-img"  src="" alt="After" />
    <div class="handle" id="handle"></div>
  </div>

  <script>
    (function() {
      const slider    = document.getElementById('slider');
      const beforeImg = document.getElementById('beforeImg');
      const afterImg  = document.getElementById('afterImg');
      const handle    = document.getElementById('handle');
      let isDragging  = false;

      function getParams() {
        const p = new URLSearchParams(window.location.search);
        return { before: p.get('before'), after: p.get('after') };
      }

      function initSlider() {
        const { before, after } = getParams();
        if (!before || !after) {
          document.body.innerHTML = '<p style="padding:1rem; font-family:sans-serif; color:red;">' +
            'Missing ?before=…&after=… in URL</p>';
          return;
        }
        beforeImg.src = before;
        afterImg.src  = after;

        // As soon as both images load, place the handle at 50%
        beforeImg.addEventListener('load', () => {
          afterImg.style.clipPath = 'inset(0 50% 0 0)';
          handle.style.left       = '50%';
        });
      }

      function onDrag(e) {
        if (!isDragging) return;
        const rect = slider.getBoundingClientRect();
        let x = (e.touches ? e.touches[0].clientX : e.clientX) - rect.left;
        if (x < 0) x = 0;
        if (x > rect.width) x = rect.width;
        const pct = (x / rect.width) * 100;
        afterImg.style.clipPath = `inset(0 ${100 - pct}% 0 0)`;
        handle.style.left       = pct + '%';
      }

      handle.addEventListener('mousedown',  () => isDragging = true);
      handle.addEventListener('touchstart', () => isDragging = true);
      document.addEventListener('mousemove', onDrag);
      document.addEventListener('touchmove',   onDrag);
      document.addEventListener('mouseup',   () => isDragging = false);
      document.addEventListener('touchend',  () => isDragging = false);

      window.addEventListener('load', initSlider);
      if (document.readyState === 'complete') initSlider();
    })();
  </script>
</body>
</html>
